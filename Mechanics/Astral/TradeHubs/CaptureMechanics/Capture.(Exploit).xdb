<?xml version="1.0" encoding="UTF-8" ?>
<gameMechanics.constructor.schemes.exploit.Exploit>
	<Header>
		<resourceId>318877712</resourceId>
	</Header>
	<visualScripts href="/Spells/VisScripts/Exploits/UseStanding.(ExploitVisScripts).xdb#xpointer(/ExploitVisScripts)" />
	<casterConditions>
		<Item type="gameMechanics.world.bigAstral.tradeWars.PredicateCanCaptureTradeAllod" />
		<Item type="gameMechanics.constructor.basicElements.PredicateOr">
			<predicates>
				<Item type="gameMechanics.constructor.basicElements.PredicateNot">
					<predicate type="gameMechanics.elements.predicates.PredicateHasContentKey">
						<key href="/System/ContentKeys/AstralTradeAllods_CaptureEvent.(ContentKey).xdb#xpointer(/basement.contentkey.ContentKey)" />
					</predicate>
				</Item>
				<Item type="gameMechanics.elements.predicates.PredicateIsRuleActive">
					<rule href="/Mechanics/Rules/Astral/TradeWarAlternativeCapture/AlternativeCaptureEvent.(RuleResource).xdb#xpointer(/gameMechanics.world.rules.RuleResource)" />
				</Item>
			</predicates>
		</Item>
	</casterConditions>
	<casterImpacts>
		<Item type="gameMechanics.constructor.basicElements.ImpactAdapter">
			<impacts>
				<Item type="gameMechanics.elements.impacts.ImpactIfCasterGeneric">
					<predicates>
						<Item type="gameMechanics.world.bigAstral.tradeWars.PredicateCanCaptureTradeAllod" />
					</predicates>
					<impactsIf>
						<Item type="gameMechanics.world.bigAstral.tradeWars.ImpactCaptureTradeAllod" />
						<Item type="gameMechanics.elements.impacts.ImpactIfCasterGeneric">
							<predicates>
								<Item type="gameMechanics.elements.predicates.PredicateFaction">
									<faction href="/World/Factions/Empire.xdb#xpointer(/gameMechanics.world.creature.Faction)" />
								</Item>
							</predicates>
							<impactsIf>
								<Item type="gameMechanics.elements.impacts.ImpactClientDataParamsGeneric">
									<distributor type="gameMechanics.elements.calcers.AstralSectorDistributor">
										<sector type="gameMechanics.world.bigAstral.elements.CurrentSectorSelector" />
										<faction type="gameMechanics.elements.calcers.ZoneDistributor$AnyFaction" />
									</distributor>
									<data href="/Mechanics/Astral/TradeHubs/ClientData/AllodCaptured.(ClientData).xdb#xpointer(/gameMechanics.world.ClientData)" />
								</Item>
								<Item type="gameMechanics.elements.impacts.ImpactsToMapHead">
									<impacts>
										<Item type="gameMechanics.elements.impacts.ImpactAllAvatarsOnMap">
											<impacts>
												<Item type="gameMechanics.elements.impacts.ImpactIfTarget">
													<predicates>
														<Item type="gameMechanics.elements.predicates.PredicateFaction">
															<faction href="/World/Factions/Empire.xdb#xpointer(/gameMechanics.world.creature.Faction)" />
														</Item>
													</predicates>
													<impactsIf>
														<Item type="gameMechanics.elements.impacts.ImpactIncreaseQuestCount">
															<id href="/World/Quests/AstralHangarHadagan/TradeAllodsCapture/QuestCountCapturedAllod.(QuestCountId).xdb#xpointer(/gameMechanics.elements.quest.QuestCountId)" />
														</Item>
													</impactsIf>
												</Item>
											</impacts>
										</Item>
									</impacts>
								</Item>
							</impactsIf>
							<impactsElse>
								<Item type="gameMechanics.elements.impacts.ImpactClientDataParamsGeneric">
									<distributor type="gameMechanics.elements.calcers.AstralSectorDistributor">
										<sector type="gameMechanics.world.bigAstral.elements.CurrentSectorSelector" />
										<faction type="gameMechanics.elements.calcers.ZoneDistributor$AnyFaction" />
									</distributor>
									<data href="/Mechanics/Astral/TradeHubs/ClientData/AllodCaptured_League.(ClientData).xdb#xpointer(/gameMechanics.world.ClientData)" />
								</Item>
								<Item type="gameMechanics.elements.impacts.ImpactsToMapHead">
									<impacts>
										<Item type="gameMechanics.elements.impacts.ImpactAllAvatarsOnMap">
											<impacts>
												<Item type="gameMechanics.elements.impacts.ImpactIfTarget">
													<predicates>
														<Item type="gameMechanics.elements.predicates.PredicateFaction">
															<faction href="/World/Factions/League.xdb#xpointer(/gameMechanics.world.creature.Faction)" />
														</Item>
													</predicates>
													<impactsIf>
														<Item type="gameMechanics.elements.impacts.ImpactIncreaseQuestCount">
															<id href="/World/Quests/AstralHangarLeague/TradeAllodsCapture/QuestCountCapturedAllod.(QuestCountId).xdb#xpointer(/gameMechanics.elements.quest.QuestCountId)" />
														</Item>
													</impactsIf>
												</Item>
											</impacts>
										</Item>
									</impacts>
								</Item>
							</impactsElse>
						</Item>
					</impactsIf>
				</Item>
			</impacts>
		</Item>
	</casterImpacts>
	<prepareDuration>60000</prepareDuration>
	<range>3.1</range>
	<needsLos>false</needsLos>
	<effectsWhileCasting>
		<Item type="gameMechanics.constructor.basicElements.EffectAdapter">
			<effects>
				<Item type="gameMechanics.elements.effects.Switch">
					<impactsOn>
						<Item type="gameMechanics.elements.impacts.ImpactsToMapHead">
							<impacts>
								<Item type="gameMechanics.elements.impacts.MapHeadFindSpawnTableGroup">
									<impacts>
										<Item type="gameMechanics.elements.impacts.ImpactIfTargetGeneric">
											<predicates>
												<Item type="gameMechanics.elements.resources.ResourceBuff">
													<buff href="DelayRecapture.(BuffResource).xdb#xpointer(/gameMechanics.constructor.schemes.buff.BuffResource)" />
												</Item>
											</predicates>
											<impactsIf>
												<Item type="gameMechanics.elements.impacts.ReturningImpactsGeneric">
													<impacts>
														<Item type="gameMechanics.elements.impacts.ImpactsDeferredGeneric">
															<delay>0</delay>
															<impacts>
																<Item type="gameMechanics.elements.impacts.ImpactResetActiveAction" />
															</impacts>
														</Item>
													</impacts>
												</Item>
												<Item type="gameMechanics.elements.impacts.ImpactClientDataParamsGeneric">
													<distributor type="gameMechanics.elements.calcers.ObjectsAroundDistributor">
														<radius>25</radius>
													</distributor>
													<data href="RecaptureDelayed.(ClientData).xdb#xpointer(/gameMechanics.world.ClientData)" />
													<calcers>
														<floatEntries>
															<Item>
																<name>timeToCapture</name>
																<calcer type="gameMechanics.elements.calcers.CalcerBuffDuration">
																	<buff href="DelayRecapture.(BuffResource).xdb#xpointer(/gameMechanics.constructor.schemes.buff.BuffResource)" />
																	<multiplier>0.001</multiplier>
																</calcer>
															</Item>
														</floatEntries>
													</calcers>
												</Item>
											</impactsIf>
											<impactsElse>
												<Item type="gameMechanics.elements.impacts.ReturningImpactsGeneric">
													<impacts>
														<Item type="gameMechanics.constructor.schemes.buff.BuffAttacherGeneric">
															<buff href="Countdown.(BuffResource).xdb#xpointer(/gameMechanics.constructor.schemes.buff.BuffResource)" />
														</Item>
														<Item type="gameMechanics.elements.impacts.ImpactInstantiatingGeneric">
															<impacts>
																<Item type="gameMechanics.elements.impacts.ImpactIfCasterGeneric">
																	<predicates>
																		<Item type="gameMechanics.elements.resources.ResourceBuff">
																			<buff href="Countdown.(BuffResource).xdb#xpointer(/gameMechanics.constructor.schemes.buff.BuffResource)" />
																		</Item>
																	</predicates>
																	<impactsIf>
																		<Item type="gameMechanics.elements.impacts.ImpactClientDataParamsGeneric">
																			<distributor type="gameMechanics.elements.calcers.ZoneDistributor">
																				<zone type="gameMechanics.elements.calcers.ZoneDistributor$OwnZone" />
																				<faction type="gameMechanics.elements.calcers.ZoneDistributor$AnyFaction" />
																			</distributor>
																			<data href="Countdown.(ClientData).xdb#xpointer(/gameMechanics.world.ClientData)" />
																			<calcers>
																				<floatEntries>
																					<Item>
																						<name>timeLeft</name>
																						<calcer type="gameMechanics.elements.calcers.CalcerBuffDuration">
																							<buff href="Countdown.(BuffResource).xdb#xpointer(/gameMechanics.constructor.schemes.buff.BuffResource)" />
																							<multiplier>0.001</multiplier>
																						</calcer>
																					</Item>
																				</floatEntries>
																			</calcers>
																		</Item>
																	</impactsIf>
																</Item>
															</impacts>
														</Item>
														<Item type="gameMechanics.elements.impacts.ImpactsDeferredGeneric">
															<delay>10000</delay>
															<limit>5</limit>
															<impacts>
																<Item type="gameMechanics.elements.impacts.ImpactInstantiatingGeneric">
																	<impacts>
																		<Item type="gameMechanics.elements.impacts.ImpactIfCasterGeneric">
																			<predicates>
																				<Item type="gameMechanics.elements.resources.ResourceBuff">
																					<buff href="Countdown.(BuffResource).xdb#xpointer(/gameMechanics.constructor.schemes.buff.BuffResource)" />
																				</Item>
																			</predicates>
																			<impactsIf>
																				<Item type="gameMechanics.elements.impacts.ImpactClientDataParamsGeneric">
																					<distributor type="gameMechanics.elements.calcers.ZoneDistributor">
																						<zone type="gameMechanics.elements.calcers.ZoneDistributor$OwnZone" />
																						<faction type="gameMechanics.elements.calcers.ZoneDistributor$AnyFaction" />
																					</distributor>
																					<data href="Countdown.(ClientData).xdb#xpointer(/gameMechanics.world.ClientData)" />
																					<calcers>
																						<floatEntries>
																							<Item>
																								<name>timeLeft</name>
																								<calcer type="gameMechanics.elements.calcers.CalcerBuffDuration">
																									<buff href="Countdown.(BuffResource).xdb#xpointer(/gameMechanics.constructor.schemes.buff.BuffResource)" />
																									<multiplier>0.001</multiplier>
																								</calcer>
																							</Item>
																						</floatEntries>
																					</calcers>
																				</Item>
																			</impactsIf>
																		</Item>
																	</impacts>
																</Item>
															</impacts>
														</Item>
													</impacts>
												</Item>
											</impactsElse>
										</Item>
									</impacts>
									<spawnGroup href="/Mechanics/Astral/TradeHubs/TradeAllodSpawnGroup.(SpawnTableGroup).xdb#xpointer(/gameMechanics.map.spawn.SpawnTableGroup)" />
								</Item>
							</impacts>
						</Item>
					</impactsOn>
					<impactsOff>
						<Item type="gameMechanics.elements.impacts.BuffDetacherGeneric">
							<buff href="Countdown.(BuffResource).xdb#xpointer(/gameMechanics.constructor.schemes.buff.BuffResource)" />
						</Item>
					</impactsOff>
				</Item>
			</effects>
		</Item>
	</effectsWhileCasting>
</gameMechanics.constructor.schemes.exploit.Exploit>
